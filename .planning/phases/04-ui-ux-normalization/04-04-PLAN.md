---
phase: 04-ui-ux-normalization
plan: 04
type: execute
wave: 2
depends_on:
  - 04-01
  - 04-02
  - 04-03
files_modified:
  - frontend/src/views/Phenopackets.vue
  - frontend/src/views/Variants.vue
  - frontend/src/views/Publications.vue
autonomous: true

must_haves:
  truths:
    - "List views use PageHeader component for consistent page titles"
    - "List views use DataTableToolbar for enhanced search and filter display"
    - "Typography hierarchy is consistent: h1 for page title, text-h5 for section headers"
    - "Icons follow consistent pattern from design tokens"
  artifacts:
    - path: "frontend/src/views/Phenopackets.vue"
      provides: "Phenopackets list with PageHeader and DataTableToolbar"
      contains: "PageHeader"
    - path: "frontend/src/views/Variants.vue"
      provides: "Variants list with PageHeader and DataTableToolbar"
      contains: "PageHeader"
    - path: "frontend/src/views/Publications.vue"
      provides: "Publications list with PageHeader and DataTableToolbar"
      contains: "PageHeader"
  key_links:
    - from: "frontend/src/views/Phenopackets.vue"
      to: "frontend/src/components/common/PageHeader.vue"
      via: "component import"
      pattern: "import PageHeader"
    - from: "frontend/src/views/Phenopackets.vue"
      to: "frontend/src/components/common/DataTableToolbar.vue"
      via: "component import"
      pattern: "import DataTableToolbar"
---

<objective>
Migrate list views (Phenopackets, Variants, Publications) to use new PageHeader and DataTableToolbar components.

Purpose: Apply design system components to the three main data table views, establishing consistent page headers, typography, and toolbar patterns.

Output: Updated Phenopackets.vue, Variants.vue, Publications.vue using PageHeader and DataTableToolbar.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ui-ux-normalization/04-CONTEXT.md
@.planning/phases/04-ui-ux-normalization/04-01-SUMMARY.md
@.planning/phases/04-ui-ux-normalization/04-02-SUMMARY.md
@.planning/phases/04-ui-ux-normalization/04-03-SUMMARY.md
@frontend/src/views/Phenopackets.vue
@frontend/src/views/Variants.vue
@frontend/src/views/Publications.vue
@frontend/src/components/common/PageHeader.vue
@frontend/src/components/common/DataTableToolbar.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Phenopackets.vue to new components</name>
  <files>frontend/src/views/Phenopackets.vue</files>
  <action>
Update `frontend/src/views/Phenopackets.vue` to use PageHeader and DataTableToolbar:

1. **Add imports:**
   ```javascript
   import PageHeader from '@/components/common/PageHeader.vue';
   import DataTableToolbar from '@/components/common/DataTableToolbar.vue';
   ```

2. **Register components** in components object.

3. **Add PageHeader before v-container:**
   ```vue
   <PageHeader
     title="Phenopacket Registry"
     subtitle="Browse and search clinical phenotype data"
     icon="mdi-account-group"
   />
   ```

4. **Replace AppTableToolbar with DataTableToolbar** in toolbar slot:
   ```vue
   <template #toolbar>
     <DataTableToolbar
       v-model:search-query="searchQuery"
       search-placeholder="Search phenopackets..."
       :result-count="pagination.totalRecords"
       result-label="phenopackets"
       :loading="loading"
       :active-filters="computedActiveFilters"
       @search="applySearch"
       @clear-search="clearSearch"
       @remove-filter="removeFilter"
       @clear-all-filters="clearAllFilters"
     >
       <template #actions>
         <!-- Create Button - Curator/Admin only -->
         <v-btn
           v-if="canCreatePhenopacket"
           icon="mdi-plus"
           variant="text"
           color="success"
           size="small"
           aria-label="Create new phenopacket"
           @click="navigateToCreate"
         />
       </template>
     </DataTableToolbar>
   </template>
   ```

5. **Add computed property for active filters:**
   ```javascript
   computedActiveFilters() {
     const filters = [];
     if (this.sexFilter) {
       filters.push({
         key: 'sex',
         label: formatSex(this.sexFilter),
         icon: getSexIcon(this.sexFilter),
         color: getSexChipColor(this.sexFilter),
       });
     }
     // Add other filters as needed
     return filters;
   },
   ```

6. **Add removeFilter method:**
   ```javascript
   removeFilter(key) {
     if (key === 'sex') {
       this.sexFilter = null;
       this.applyFilters();
     }
   },
   ```

7. **Remove the old "Clear Filters" button** from actions slot (now handled by DataTableToolbar).

8. **Remove title prop from AppDataTable** (now in PageHeader).

9. **Update hasActiveFilters and activeFilterCount computed** to use new filter system or remove if redundant.

**Note:** Keep the AppTableToolbar import for now but remove the Clear Filters button logic that was in the actions slot. The DataTableToolbar handles clear all internally.
  </action>
  <verify>
    `grep "import PageHeader" frontend/src/views/Phenopackets.vue` returns match
    `grep "import DataTableToolbar" frontend/src/views/Phenopackets.vue` returns match
    `grep "<PageHeader" frontend/src/views/Phenopackets.vue` returns match
    `cd frontend && npm run build 2>&1 | head -20` compiles without errors
  </verify>
  <done>
    Phenopackets.vue uses PageHeader for title and DataTableToolbar for search/filters
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate Variants.vue to new components</name>
  <files>frontend/src/views/Variants.vue</files>
  <action>
Update `frontend/src/views/Variants.vue` to use PageHeader and DataTableToolbar:

1. **Add imports:**
   ```javascript
   import PageHeader from '@/components/common/PageHeader.vue';
   import DataTableToolbar from '@/components/common/DataTableToolbar.vue';
   ```

2. **Register components** in components object.

3. **Add PageHeader before v-container:**
   ```vue
   <PageHeader
     title="Variants Registry"
     subtitle="Browse and search genetic variants in HNF1B"
     icon="mdi-dna"
     icon-color="pink"
   />
   ```

4. **Replace AppTableToolbar with DataTableToolbar:**
   ```vue
   <template #toolbar>
     <DataTableToolbar
       v-model:search-query="searchQuery"
       search-placeholder="Search HGVS, gene symbol, or variant ID..."
       :result-count="pagination.totalRecords"
       result-label="variants"
       :loading="loading"
       :active-filters="computedActiveFilters"
       @search="onSearch"
       @clear-search="onClearSearch"
       @remove-filter="removeFilter"
       @clear-all-filters="clearAllFilters"
     />
   </template>
   ```

5. **Add computed property for active filters:**
   ```javascript
   computedActiveFilters() {
     const filters = [];
     if (this.typeFilter) {
       filters.push({
         key: 'type',
         label: this.typeFilter,
         icon: 'mdi-dna',
         color: 'purple-lighten-3',
       });
     }
     if (this.classificationFilter) {
       filters.push({
         key: 'classification',
         label: this.classificationFilter,
         icon: 'mdi-shield-check',
         color: getPathogenicityColor(this.classificationFilter),
       });
     }
     return filters;
   },
   ```

6. **Add removeFilter method:**
   ```javascript
   removeFilter(key) {
     if (key === 'type') {
       this.typeFilter = null;
     } else if (key === 'classification') {
       this.classificationFilter = null;
     }
     this.applyFilters();
   },
   ```

7. **Remove the old "Clear Filters" button** from template.

8. **Remove title prop from AppDataTable.**

**Import getPathogenicityColor** from @/utils/colors if not already imported.
  </action>
  <verify>
    `grep "import PageHeader" frontend/src/views/Variants.vue` returns match
    `grep "import DataTableToolbar" frontend/src/views/Variants.vue` returns match
    `grep "<PageHeader" frontend/src/views/Variants.vue` returns match
    `cd frontend && npm run build 2>&1 | head -20` compiles without errors
  </verify>
  <done>
    Variants.vue uses PageHeader for title and DataTableToolbar for search/filters
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate Publications.vue to new components</name>
  <files>frontend/src/views/Publications.vue</files>
  <action>
Update `frontend/src/views/Publications.vue` to use PageHeader and DataTableToolbar:

1. **Add imports:**
   ```javascript
   import PageHeader from '@/components/common/PageHeader.vue';
   import DataTableToolbar from '@/components/common/DataTableToolbar.vue';
   ```

2. **Register components** in components object.

3. **Add PageHeader before v-container:**
   ```vue
   <PageHeader
     title="Publications"
     subtitle="Scientific literature on HNF1B variants and phenotypes"
     icon="mdi-file-document-multiple"
     icon-color="cyan-darken-1"
   />
   ```

4. **Replace AppTableToolbar with DataTableToolbar:**
   ```vue
   <template #toolbar>
     <DataTableToolbar
       v-model:search-query="searchQuery"
       search-placeholder="Search publications..."
       :result-count="pagination.totalRecords"
       result-label="publications"
       :loading="loading"
       :active-filters="computedActiveFilters"
       @search="onSearch"
       @clear-search="onClearSearch"
       @remove-filter="removeFilter"
       @clear-all-filters="clearAllFilters"
     />
   </template>
   ```

5. **Add computed property for active filters** (if Publications has filters):
   ```javascript
   computedActiveFilters() {
     const filters = [];
     // Add year filter, type filter, etc. if they exist
     return filters;
   },
   ```

6. **Add removeFilter method** (even if empty for now):
   ```javascript
   removeFilter(key) {
     // Handle filter removal
     this.applyFilters();
   },
   ```

7. **Remove any old "Clear Filters" button** from template if present.

8. **Remove title prop from AppDataTable** if used.

**Note:** Publications may have different filter patterns. Adapt the filter structure to match existing filters in the view.
  </action>
  <verify>
    `grep "import PageHeader" frontend/src/views/Publications.vue` returns match
    `grep "import DataTableToolbar" frontend/src/views/Publications.vue` returns match
    `grep "<PageHeader" frontend/src/views/Publications.vue` returns match
    `cd frontend && npm run build 2>&1 | head -20` compiles without errors
  </verify>
  <done>
    Publications.vue uses PageHeader for title and DataTableToolbar for search/filters
  </done>
</task>

</tasks>

<verification>
1. All three list views have PageHeader component at top
2. All three list views use DataTableToolbar for search and filters
3. Consistent icon usage: account-group (phenopackets), dna (variants), file-document-multiple (publications)
4. Active filters display as chips in DataTableToolbar
5. Frontend builds without errors: `cd frontend && npm run build`
6. Frontend tests pass: `cd frontend && npm test`
7. Visual check: Page headers render consistently, filter chips work correctly
</verification>

<success_criteria>
- Phenopackets.vue imports and uses PageHeader, DataTableToolbar
- Variants.vue imports and uses PageHeader, DataTableToolbar
- Publications.vue imports and uses PageHeader, DataTableToolbar
- Consistent title typography (h1 via PageHeader)
- Consistent icon colors per data type
- Filter chips display in toolbar with remove functionality
- Build passes, tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-ux-normalization/04-04-SUMMARY.md`
</output>
