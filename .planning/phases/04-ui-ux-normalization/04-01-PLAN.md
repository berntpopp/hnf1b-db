---
phase: 04-ui-ux-normalization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/utils/designTokens.js
  - frontend/src/plugins/vuetify.js
  - frontend/src/utils/aggregationConfig.js
autonomous: true

must_haves:
  truths:
    - "All colors have single source of truth in designTokens.js"
    - "Charts display same colors as chips for same semantic values (sex, pathogenicity)"
    - "Vuetify theme imports colors from design tokens"
    - "Accent color changed from coral to gold/amber"
  artifacts:
    - path: "frontend/src/utils/designTokens.js"
      provides: "Centralized color definitions with hex + Vuetify class mappings"
      min_lines: 100
      exports: ["COLORS", "SEX_COLORS", "PATHOGENICITY_COLORS", "DATA_COLORS", "SPACING", "getChartColor", "getVuetifyColor", "buildChartColorMap"]
    - path: "frontend/src/plugins/vuetify.js"
      provides: "Theme using imported design tokens"
      contains: "import.*designTokens"
    - path: "frontend/src/utils/aggregationConfig.js"
      provides: "Chart colors imported from designTokens"
      contains: "import.*designTokens"
  key_links:
    - from: "frontend/src/plugins/vuetify.js"
      to: "frontend/src/utils/designTokens.js"
      via: "import statement"
      pattern: "import.*from.*designTokens"
    - from: "frontend/src/utils/aggregationConfig.js"
      to: "frontend/src/utils/designTokens.js"
      via: "import statement"
      pattern: "import.*from.*designTokens"
---

<objective>
Create centralized design tokens file and update Vuetify theme to use it.

Purpose: Establish single source of truth for all colors, unify chart colors with chip colors, and prepare design system foundation for remaining UI normalization work.

Output: designTokens.js with all semantic colors, updated vuetify.js importing from tokens, updated aggregationConfig.js using token colors for charts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ui-ux-normalization/04-CONTEXT.md
@.planning/phases/04-ui-ux-normalization/04-RESEARCH.md
@frontend/src/plugins/vuetify.js
@frontend/src/utils/sex.js
@frontend/src/utils/colors.js
@frontend/src/utils/aggregationConfig.js
@docs/COLOR_STYLE_GUIDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design tokens file</name>
  <files>frontend/src/utils/designTokens.js</files>
  <action>
Create `frontend/src/utils/designTokens.js` with three-tier token architecture:

1. **GLOBAL TOKENS** - Brand colors:
   - PRIMARY: '#009688' (teal - keep established)
   - PRIMARY_DARKEN_1: '#00796B'
   - PRIMARY_LIGHTEN_3: '#4DB6AC'
   - PRIMARY_LIGHTEN_4: '#80CBC4'
   - SECONDARY: '#37474F' (slate)
   - SECONDARY_DARKEN_1: '#263238'
   - ACCENT: '#FFB300' (gold/amber - CHANGED from coral per CONTEXT.md)
   - ACCENT_LIGHTEN_3: '#FFE082'
   - BACKGROUND: '#F5F7FA'
   - SURFACE: '#FFFFFF'
   - ERROR: '#B00020'
   - SUCCESS: '#4CAF50'
   - WARNING: '#FB8C00'
   - INFO: '#2196F3'

2. **SEMANTIC TOKENS** - Dual format (vuetify class + hex):
   - SEX_COLORS: MALE (blue-lighten-3/#64B5F6), FEMALE (pink-lighten-3/#F48FB1), OTHER_SEX (purple-lighten-3/#BA68C8), UNKNOWN_SEX (grey-lighten-2/#EEEEEE)
   - PATHOGENICITY_COLORS: PATHOGENIC (red-lighten-1/#EF5350), LIKELY_PATHOGENIC (orange-lighten-1/#FF9800), VUS (yellow-darken-1/#FBC02D), LIKELY_BENIGN (light-green-lighten-1/#9CCC65), BENIGN (green-lighten-1/#66BB6A)
   - DATA_COLORS: PHENOPACKET (teal-lighten-3/#4DB6AC), VARIANT (pink-lighten-3/#F48FB1), PUBLICATION (orange-lighten-3/#FFB74D), PHENOTYPE (green-lighten-3/#81C784)

3. **SPACING TOKENS** - Document Vuetify's system:
   - XS: 4 (ma-1), SM: 8 (ma-2), MD: 16 (ma-4), LG: 24 (ma-6), XL: 32 (ma-8)

4. **HELPER FUNCTIONS**:
   - `getChartColor(category, value)` - returns hex for D3 charts
   - `getVuetifyColor(category, value)` - returns Vuetify class for chips
   - `buildChartColorMap(category)` - returns full color map for D3

Include JSDoc documentation. Use named exports for tree-shaking.
  </action>
  <verify>
    File exists at frontend/src/utils/designTokens.js
    `grep -c "export" frontend/src/utils/designTokens.js` shows 8+ exports
    `grep "FFB300" frontend/src/utils/designTokens.js` finds accent color
  </verify>
  <done>
    designTokens.js created with COLORS, SEX_COLORS, PATHOGENICITY_COLORS, DATA_COLORS, SPACING exports and helper functions
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Vuetify theme to import design tokens</name>
  <files>frontend/src/plugins/vuetify.js</files>
  <action>
Update `frontend/src/plugins/vuetify.js` to import colors from designTokens.js:

1. Add import statement at top:
   `import { COLORS } from '@/utils/designTokens';`

2. Update hnf1bTheme.colors to use COLORS object:
   - background: COLORS.BACKGROUND
   - surface: COLORS.SURFACE
   - primary: COLORS.PRIMARY
   - 'primary-darken-1': COLORS.PRIMARY_DARKEN_1
   - secondary: COLORS.SECONDARY
   - 'secondary-darken-1': COLORS.SECONDARY_DARKEN_1
   - accent: COLORS.ACCENT (this changes from '#FF8A65' to '#FFB300')
   - error: COLORS.ERROR
   - info: COLORS.INFO
   - success: COLORS.SUCCESS
   - warning: COLORS.WARNING

3. Keep existing defaults (VCard, VBtn, VTextField, VSelect, icons) unchanged.

4. Update the comment at top to reflect new structure.
  </action>
  <verify>
    `grep "import.*designTokens" frontend/src/plugins/vuetify.js` returns match
    `grep "COLORS.PRIMARY" frontend/src/plugins/vuetify.js` returns match
    `cd frontend && npm run build 2>&1 | head -20` compiles without errors
  </verify>
  <done>
    vuetify.js imports COLORS from designTokens.js, accent changed to gold/amber
  </done>
</task>

<task type="auto">
  <name>Task 3: Update aggregation chart colors to use design tokens</name>
  <files>frontend/src/utils/aggregationConfig.js</files>
  <action>
Update `frontend/src/utils/aggregationConfig.js` to import from designTokens.js and use consistent colors:

1. Add import at top:
   `import { SEX_COLORS, PATHOGENICITY_COLORS } from '@/utils/designTokens';`

2. Update AGGREGATION_COLOR_MAPS.getSexDistribution to use SEX_COLORS hex values:
   - MALE: SEX_COLORS.MALE.hex ('#64B5F6' - was '#1976D2')
   - FEMALE: SEX_COLORS.FEMALE.hex ('#F48FB1' - was '#E91E63')
   - OTHER_SEX: SEX_COLORS.OTHER_SEX.hex ('#BA68C8')
   - UNKNOWN_SEX: SEX_COLORS.UNKNOWN_SEX.hex ('#EEEEEE')

3. Update AGGREGATION_COLOR_MAPS.getVariantPathogenicity to use PATHOGENICITY_COLORS hex values:
   - Pathogenic: PATHOGENICITY_COLORS.PATHOGENIC.hex
   - 'Likely Pathogenic': PATHOGENICITY_COLORS.LIKELY_PATHOGENIC.hex
   - 'Uncertain Significance': PATHOGENICITY_COLORS.VUS.hex
   - 'Likely Benign': PATHOGENICITY_COLORS.LIKELY_BENIGN.hex
   - Benign: PATHOGENICITY_COLORS.BENIGN.hex

4. Keep getVariantTypes and getPublicationTypes as hardcoded hex for now (no existing semantic tokens).

5. Add comment noting color source: "// Colors imported from designTokens.js for consistency with chips"
  </action>
  <verify>
    `grep "import.*designTokens" frontend/src/utils/aggregationConfig.js` returns match
    `grep "SEX_COLORS.MALE.hex" frontend/src/utils/aggregationConfig.js` returns match
    `cd frontend && npm run build 2>&1 | head -20` compiles without errors
    `cd frontend && npm test 2>&1 | grep -E "(PASS|FAIL|Tests:)"` tests pass
  </verify>
  <done>
    Chart colors now import from designTokens.js, sex and pathogenicity charts match chip colors
  </done>
</task>

</tasks>

<verification>
1. Design tokens file exists with all expected exports
2. Vuetify theme compiles and uses imported tokens
3. Aggregation charts use consistent colors from tokens
4. Frontend builds without errors: `cd frontend && npm run build`
5. Frontend tests pass: `cd frontend && npm test`
6. Visual spot check: Start app and verify accent color is gold not coral
</verification>

<success_criteria>
- designTokens.js created with 8+ named exports
- vuetify.js imports COLORS from designTokens.js
- aggregationConfig.js imports SEX_COLORS, PATHOGENICITY_COLORS from designTokens.js
- Accent color changed from coral (#FF8A65) to gold/amber (#FFB300)
- Sex chart colors match sex chip colors (#64B5F6 for male, #F48FB1 for female)
- Build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-ux-normalization/04-01-SUMMARY.md`
</output>
