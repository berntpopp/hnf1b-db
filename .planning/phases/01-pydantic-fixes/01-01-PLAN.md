---
phase: 01-pydantic-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/reference/schemas.py
  - backend/app/phenopackets/models.py
autonomous: true

must_haves:
  truths:
    - "Backend imports produce zero Pydantic deprecation warnings"
    - "All existing tests pass unchanged"
    - "API responses remain identical (no breaking changes)"
  artifacts:
    - path: "backend/app/reference/schemas.py"
      provides: "Reference genome schemas without deprecated Config pattern"
      contains: "model_config = ConfigDict"
    - path: "backend/app/phenopackets/models.py"
      provides: "Phenopacket response schemas without deprecated Config pattern"
      contains: "model_config = ConfigDict"
  key_links:
    - from: "backend/app/reference/schemas.py"
      to: "pydantic.ConfigDict"
      via: "import statement"
      pattern: "from pydantic import.*ConfigDict"
    - from: "backend/app/phenopackets/models.py"
      to: "pydantic.ConfigDict"
      via: "import statement"
      pattern: "from pydantic import.*ConfigDict"
---

<objective>
Migrate all class-based Pydantic Config patterns to ConfigDict in backend schemas.

Purpose: Eliminate 7 deprecation warnings that will become errors in Pydantic v3.0. The codebase already uses modern `pattern=` and `examples=[]` patterns - only the Config class deprecation remains.

Output: Two updated schema files with zero deprecation warnings.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-pydantic-fixes/01-RESEARCH.md

@backend/app/reference/schemas.py
@backend/app/phenopackets/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate reference/schemas.py to ConfigDict</name>
  <files>backend/app/reference/schemas.py</files>
  <action>
Update backend/app/reference/schemas.py to replace all class-based Config with ConfigDict:

1. Update import statement (line 7):
   FROM: `from pydantic import BaseModel, Field`
   TO: `from pydantic import BaseModel, ConfigDict, Field`

2. Replace 5 Config class blocks with model_config attribute:

   - ReferenceGenomeSchema (lines 28-31): Replace `class Config:` block with `model_config = ConfigDict(from_attributes=True)` as first class attribute after docstring

   - ExonSchema (lines 47-50): Same replacement

   - ProteinDomainSchema (lines 71-74): Same replacement

   - TranscriptSchema (lines 95-98): Same replacement

   - GeneSchema (lines 128-131): Same replacement

Pattern for each replacement:
```python
# REMOVE this block:
    class Config:
        """Pydantic configuration."""

        from_attributes = True

# ADD this line after class docstring, before field definitions:
    model_config = ConfigDict(from_attributes=True)
```

Note: TranscriptDetailSchema, GeneDetailSchema, GeneWithExonsSchema, ProteinDomainsResponse, and GenomicRegionResponse do NOT have Config classes - they either inherit from parent classes or don't need from_attributes. Leave them unchanged.
  </action>
  <verify>
```bash
cd /home/bernt-popp/development/hnf1b-db/backend
uv run python -c "from app.reference.schemas import ReferenceGenomeSchema, ExonSchema, ProteinDomainSchema, TranscriptSchema, GeneSchema; print('Import successful')"
```
  </verify>
  <done>All 5 schemas in reference/schemas.py use ConfigDict pattern instead of class Config</done>
</task>

<task type="auto">
  <name>Task 2: Migrate phenopackets/models.py to ConfigDict</name>
  <files>backend/app/phenopackets/models.py</files>
  <action>
Update backend/app/phenopackets/models.py to replace class-based Config with ConfigDict:

1. Update import statement (line 9):
   FROM: `from pydantic import BaseModel, Field, field_validator`
   TO: `from pydantic import BaseModel, ConfigDict, Field, field_validator`

2. Replace 2 Config class blocks with model_config attribute:

   - PhenopacketResponse (lines 432-435): Replace `class Config:` block with `model_config = ConfigDict(from_attributes=True)` as first class attribute after docstring

   - PhenopacketAuditResponse (lines 472-475): Same replacement

Pattern for each replacement:
```python
# REMOVE this block:
    class Config:
        """Pydantic config for ORM mode."""

        from_attributes = True

# ADD this line after class docstring, before field definitions:
    model_config = ConfigDict(from_attributes=True)
```

Note: All other Pydantic models in this file (OntologyClass, TimeElement, Evidence, PhenotypicFeature, etc.) do NOT have Config classes - they don't need from_attributes since they're not ORM models. Leave them unchanged.
  </action>
  <verify>
```bash
cd /home/bernt-popp/development/hnf1b-db/backend
uv run python -c "from app.phenopackets.models import PhenopacketResponse, PhenopacketAuditResponse; print('Import successful')"
```
  </verify>
  <done>Both PhenopacketResponse and PhenopacketAuditResponse use ConfigDict pattern instead of class Config</done>
</task>

</tasks>

<verification>
Run all quality checks to ensure the migration is complete and correct:

```bash
cd /home/bernt-popp/development/hnf1b-db/backend

# 1. Verify zero deprecation warnings on import
uv run python -W all -c "import app.main" 2>&1 | grep -c "class-based.*config.*deprecated" || echo "0 warnings"

# 2. Run linting
make lint

# 3. Run type checking
make typecheck

# 4. Run full test suite
make test
```

All commands must pass with zero errors.
</verification>

<success_criteria>
1. Zero Pydantic deprecation warnings when importing app.main
2. `make lint` passes
3. `make typecheck` passes
4. `make test` passes (all existing tests)
5. No API behavior changes (from_attributes=True preserved)
</success_criteria>

<output>
After completion, create `.planning/phases/01-pydantic-fixes/01-01-SUMMARY.md`
</output>
